if(typeof jQuery>"u")throw new Error("MultiTabs requires jQuery");(function(l){"use strict";var y,j=".multitabs",f=function(t,a,e,n,s){var i=s?a:a.split(" ").join(j+" ")+j;t.off(i,e,n).on(i,e,n)},W=function(t,a){return t==="main"?0:(a=a||8,y=y||0,y++,y%=a)},O=function(t,a){var e,n,s,i;for(a=a||l.fn.multitabs.defaults.navTab.maxTitleLength,e=(t+"").split(" "),n="",s=0;s<e.length;s++)i=l.trim(e[s]),n+=i?i+" ":"";return n.length>a&&(n=n.substr(0,a),n+="..."),n},T=function(t){return sessionStorage!==void 0&&t},h=function(t){var a=0;return l(t).each(function(){a+=l(this).outerWidth(!0)}),a},S=function(t){var a=function(s){var i=document.createElement("a");return i.href=s,i.href}(t),e=window.location.protocol+"//"+window.location.host+"/",n=a.substr(0,e.length);return n!==e},g={default:'<div class="mt-wrapper {mainClass}" style="height: 100%;" ><div class="mt-nav-bar {navClass}" style="background-color: {backgroundColor};"><div class="mt-nav mt-nav-tools-left"><ul  class="nav {nav-tabs}"><li class="nav-item mt-move-left"><a class="nav-link"><i class="mdi mdi-skip-backward"></i></a></li></ul></div><nav class="mt-nav mt-nav-panel"><ul  class="nav {nav-tabs}"></ul></nav><div class="mt-nav mt-nav-tools-right"><ul  class="nav {nav-tabs}"><li class="nav-item mt-move-right"><a class="nav-link"><i class="mdi mdi-skip-forward"></i></a></li><li class="nav-item mt-dropdown dropdown"><a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">{dropdown}<span class="caret"></span></a><ul role="menu" class="dropdown-menu dropdown-menu-right"><li class="mt-show-actived-tab"><a class="dropdown-item">{showActivedTab}</a></li><li class="dropdown-divider"></li><li class="mt-close-all-tabs"><a class="dropdown-item">{closeAllTabs}</a></li><li class="mt-close-other-tabs"><a class="dropdown-item">{closeOtherTabs}</a></li></ul></li></ul></div></div><div class="tab-content mt-tab-content " > </div></div>',classic:'<div class="mt-wrapper {mainClass}" style="height: 100%;" ><div class="mt-nav-bar {navClass}" style="background-color: {backgroundColor};"><nav class="mt-nav mt-nav-panel"><ul  class="nav {nav-tabs}"> </ul></nav><div class="mt-nav mt-nav-tools-right"><ul  class="nav {nav-tabs}"><li class="mt-dropdown dropdown"><a href="#"  class="dropdown-toggle dropdown-item" data-toggle="dropdown">{dropdown}<span class="caret"></span></a><ul role="menu" class="mt-hidden-list dropdown-menu dropdown-menu-right"></ul></li></ul></div></div><div class="tab-content mt-tab-content " > </div></div>',simple:'<div class="mt-wrapper {mainClass}" style="height: 100%;" ><div class="mt-nav-bar {navClass}" style="background-color: {backgroundColor};"><nav class="mt-nav mt-nav-panel"><ul  class="nav {nav-tabs}"> </ul></nav></div><div class="tab-content mt-tab-content " > </div></div>',navTab:'<a data-id="{navTabId}" class="nav-link mt-nav-tab" data-type="{type}" data-index="{index}" data-url="{url}">{title}</a>',closeBtn:' <i class="mt-close-tab mdi mdi-close" style="{style}"></i>',ajaxTabPane:'<div id="{tabPaneId}" class="tab-pane {class}">{content}</div>',iframeTabPane:'<iframe id="{tabPaneId}" class="tab-pane {class}"  width="100%" height="100%" frameborder="0" src="" seamless></iframe>'},$=[{type:"main",title:"main",content:"<h1>Demo page</h1><h2>Welcome to use bootstrap multi-tabs :) </h2>"}],L=function(t,a){var e=this;e.$element=l(t),e._init(a)._listen()._final()};L.prototype={constructor:L,create:function(t,a){this.options;var e,n;return(e=this._getParam(t))?(n=this._exist(e),n&&!e.isNewTab?(this.active(n),this):(e.active=e.active?e.active:a,n=this._createNavTab(e),this._createTabPane(e),this._storage(e.did,e),e.active&&this.active(n),this)):this},_createTabPane:function(t){var a=this,e=a.$element;return e.tabContent.append(a._getTabPaneHtml(t)),e.tabContent.find("#"+t.did)},_getTabPaneHtml:function(t){var a=this,e=a.options;return!t.content&&t.iframe?g.iframeTabPane.replace("{class}",e.content.iframe.class).replace("{tabPaneId}",t.did):g.ajaxTabPane.replace("{class}",e.content.ajax.class).replace("{tabPaneId}",t.did).replace("{content}",t.content)},_createNavTab:function(t){var a=this,e=a.$element,n=a._getNavTabHtml(t),s=e.navPanelList.find('a[data-type="'+t.type+'"][data-index="'+t.index+'"]').parent("li");return s.length?(s.html(n),a._getTabPane(s.find("a:first")).remove()):e.navPanelList.append('<li class="nav-item">'+n+"</li>"),e.navPanelList.find('a[data-type="'+t.type+'"][data-index="'+t.index+'"]:first')},_getNavTabHtml:function(t){var a=this,e=a.options,n=e.nav.showCloseOnHover?"":"display:inline;",s=t.type==="main"?"":g.closeBtn.replace("{style}",n);return g.navTab.replace("{index}",t.index).replace("{navTabId}",t.did).replace("{url}",t.url).replace("{title}",t.title).replace("{type}",t.type)+s},_generateId:function(t){return"multitabs_"+t.type+"_"+t.index},active:function(t,a){var e,n,s,i,r,c,o=this,v=o.$element;return a=a!=0,e=o._getNavTab(t),n=o._getTabPane(e),s=v.navPanelList.find("li a.active"),i=s.length?o._getParam(s):{},r=e.length?o._getParam(e):{},c=o._storage(),c[i.id]&&(c[i.id].active=!1),c[r.id]&&(c[r.id].active=!0),o._resetStorage(c),s.removeClass("active"),e.addClass("active"),o._fixTabPosition(e),o._getTabPane(s).removeClass("active"),n.addClass("active"),o._fixTabContentLayout(n),o._fillTabPane(n,r,a),o},_fillTabPane:function(t,a,e){var n=this,s=n.options,i=l(t);i.html()||(i.is("iframe")?(!i.attr("src")&&s.refresh=="no"||s.refresh=="nav"&&e||s.refresh=="all")&&i.attr("src",a.url):l.ajax({url:a.url,dataType:"html",success:function(r){i.html(s.content.ajax.success(r))},error:function(r){i.html(s.content.ajax.error(r))}}))},moveLeft:function(){var t,a=this,e=a.$element,n=Math.abs(parseInt(e.navPanelList.css("margin-left"))),s=e.navPanel.outerWidth(!0),i=h(e.navPanelList.children("li")),r=0,c=0;if(s>i)return a;for(t=e.navPanelList.children("li:first");c+t.width()<=n;)c+=t.outerWidth(!0),t=t.next();if(c=0,h(t.prevAll())>s){for(;c+t.width()<s&&t.length>0;)c+=t.outerWidth(!0),t=t.prev();r=h(t.prevAll())}return e.navPanelList.animate({marginLeft:0-r+"px"},"fast"),a},moveRight:function(){var t,a,e=this,n=e.$element,s=Math.abs(parseInt(n.navPanelList.css("margin-left"))),i=n.navPanel.outerWidth(!0),r=h(n.navPanelList.children("li")),c=0;if(i>r)return e;for(t=n.navPanelList.children("li:first"),a=0;a+t.width()<=s;)a+=t.outerWidth(!0),t=t.next();for(a=0;a+t.width()<i&&t.length>0;)a+=t.outerWidth(!0),t=t.next();return c=h(t.prevAll()),c>0&&n.navPanelList.animate({marginLeft:0-c+"px"},"fast"),e},close:function(t){var a,e,n=this,s=n._getNavTab(t),i=s.parent("li"),r=n._getTabPane(s);return i.length&&r.length&&r.hasClass("unsave")&&!n._unsaveConfirm()||(i.find("a").hasClass("active")&&(a=i.next("li:first"),e=i.prev("li:last"),a.length?(n.active(a),n.activeMenu(a.find("a"))):e.length&&(n.active(e),n.activeMenu(e.find("a")))),n._delStorage(s.attr("data-id")),i.remove(),r.remove()),n},closeOthers:function(t){var a,e=this,n=e.$element;return a=t?n.navPanelList.find('a:not([data-type="main"])').filter(function(){return t!=l(this).data("index")?this:void 0}):n.navPanelList.find('li a:not([data-type="main"],.active)'),a.each(function(){var s=l(this);e._delStorage(s.attr("data-id")),e._getTabPane(s).remove(),s.parent("li").remove()}),t&&(e.active(n.navPanelList.find('a[data-index="'+t+'"]')),e.activeMenu(n.navPanelList.find('a[data-index="'+t+'"]'))),n.navPanelList.css("margin-left","0"),e},showActive:function(){var t=this,a=t.$element,e=a.navPanelList.find("li a.active");return t._fixTabPosition(e),t},closeAll:function(){var t=this,a=t.$element;return a.navPanelList.find('a:not([data-type="main"])').each(function(){var e=l(this);t._delStorage(e.attr("data-id")),t._getTabPane(e).remove(),e.parent("li").remove()}),t.active(a.navPanelList.find('a[data-type="main"]:first').parent("li")),t.activeMenu(a.navPanelList.find('a[data-type="main"]:first')),t},activeMenu:function(t){var a,e=l("a[href$='"+l(t).data("url")+"']"),n=e.parents(".nav-item"),s=n.siblings().find(".nav-subnav:visible").outerHeight();l(".nav-item").each(function(){l(this).hasClass("active")&&!e.parents(".nav-item").last().hasClass("active")&&(l(this).removeClass("active").removeClass("open"),l(this).find(".nav-subnav:visible").slideUp(500),window.innerWidth>1024&&l("body").hasClass("lyear-layout-sidebar-close")&&l(this).find(".nav-subnav").hide())}),l(".nav-drawer").find("li").removeClass("active"),e.parent("li").addClass("active"),n.first().addClass("active"),e.parents(".nav-item").first().is(".nav-item-has-subnav")||(a=48*(e.parents(".nav-item").first().prevAll().length-1),l(".lyear-layout-sidebar-info").animate({scrollTop:a},300)),e.parents("ul.nav-subnav").last().is(":hidden")&&e.parents("ul.nav-subnav").last().slideDown(500,function(){n.last().addClass("open");var i=0,r=l(".lyear-layout-sidebar-info"),c=n.last().prevAll().length,o=r.outerHeight(),v=l(".sidebar-main").outerHeight(),u=r.scrollTop(),d=l(this).outerHeight(),m=121;m+v-o>=48*c&&(i=48*c),n.length==1?r.animate({scrollTop:i},300):typeof s<"u"&&s!=null?(i=u+d-s,r.animate({scrollTop:i},300)):u+o-r[0].scrollHeight==0&&(i=u-d,r.animate({scrollTop:i},300))})},_init:function(t){var a=this,e=a.$element;return e.html(g[t.nav.layout].replace("{mainClass}",t.class).replace("{navClass}",t.nav.class).replace(/\{nav-tabs\}/g,t.nav.style).replace(/\{backgroundColor\}/g,t.nav.backgroundColor).replace("{dropdown}",t.language.nav.dropdown).replace("{showActivedTab}",t.language.nav.showActivedTab).replace("{closeAllTabs}",t.language.nav.closeAllTabs).replace("{closeOtherTabs}",t.language.nav.closeOtherTabs)),e.wrapper=e.find(".mt-wrapper:first"),e.nav=e.find(".mt-nav-bar:first"),e.navToolsLeft=e.nav.find(".mt-nav-tools-left:first"),e.navPanel=e.nav.find(".mt-nav-panel:first"),e.navPanelList=e.nav.find(".mt-nav-panel:first ul"),e.navToolsRight=e.nav.find(".mt-nav-tools-right:first"),e.tabContent=e.find(".tab-content:first"),t.nav.maxTabs<=1&&(t.nav.maxTabs=1,e.nav.hide()),e.navPanel.css("width","calc(100% - 147px)"),a.options=t,a},_final:function(){var t,a,e,n=this,s=n.$element,i=n.options,r=i.init;if(T(i.cache)&&(t=n._storage(),n._resetStorage({}),l.each(t,function(c,o){n.create(o,!1)})),l.isEmptyObject(t))for(r=!l.isEmptyObject(r)&&r instanceof Array?r:$,e=0;e<r.length;e++)a=n._getParam(r[e]),a&&n.create(a);return s.navPanelList.children("li a.active").length||n.active(s.navPanelList.find('[data-type="main"]:first')),n},_listen:function(){var t,a=this,e=a.$element,n=a.options;return f(l(document),"click",n.selector,function(){return a.create(this,!0),l(this).parent().parent("ul").hasClass("dropdown-menu")?void 0:!1}),f(e.nav,"click",".mt-nav-tab",function(){a.active(this,!1),a.activeMenu(this)}),n.nav.draggable&&f(e.navPanelList,"mousedown",".mt-nav-tab",function(s){var i=l(this),r=i.closest("li"),c=r.prev(),o=!0,v=!1,u=i.data("type")==="main",d="mt_tmp_id_"+new Date().getTime(),m='<li id="'+d+'" class="mt-dragging" style="width:'+r.outerWidth()+"px; height:"+r.outerHeight()+'px;"><a style="width: 100%;  height: 100%; "></a></li>',b=s.pageX-r.offset().left+e.nav.offset().left;r.before(m),r.addClass("mt-dragging mt-dragging-tab").css({left:s.pageX-b+"px"}),l(document).on("mousemove",function(w){o&&!u&&(r.css({left:w.pageX-b+"px"}),e.navPanelList.children('li:not(".mt-dragging")').each(function(){var p=l(this).offset().left+l(this).outerWidth()+20;return p>r.offset().left?(l(this).next().attr("id")!==d&&(v=!0,c=l(this),l("#"+d).remove(),c.after(m)),!1):void 0}))}).on("selectstart",function(){return o?!1:void 0}).on("mouseup",function(){o&&(r.removeClass("mt-dragging mt-dragging-tab").css({left:"auto"}),v&&c.after(r),l("#"+d).remove()),o=!1})}),f(e.nav,"contextmenu",".mt-nav-tab",function(s){var i,r,c,o,v,u,d,m,b,w,p,P,x,C,A,N;for(s.preventDefault(),i=l('<ul class="dropdown-menu" role="menu" id="contextify-menu"/>'),r=l(this),c=r.closest("li"),o=a._getNavTab(c),v=a._getTabPane(o),u=o.length?a._getParam(o):{},d=[{text:"\u5237\u65B0",onclick:function(){var _=l(v);return _.is("iframe")?_.attr("src",u.url):l.ajax({url:u.url,dataType:"html",success:function(k){_.html(a.options.content.ajax.success(k))},error:function(k){_.html(a.options.content.ajax.error(k))}}),i.hide(),!1}}],u=a._getParam(o),u.type!=="main"&&d.push({text:"\u5173\u95ED",onclick:function(){return a.close(o),i.hide(),!1}}),d.push({text:"\u5173\u95ED\u5176\u4ED6",onclick:function(){return a.closeOthers(o.data("index")),i.hide(),!1}}),b=d.length,m=0;b>m;m++)w=d[m],p=l("<li/>"),p.append('<a class="dropdown-item" />'),P=p.find("a"),P.on("click",w.onclick),P.css("cursor","pointer"),P.html(w.text),i.append(p);x=l("#contextify-menu"),x.length>0?x!==i&&x.replaceWith(i):l("body").append(i),C=l(window).scrollTop()+s.clientY,A=i.width()+s.clientX<l(window).width()?s.clientX:s.clientX-i.width(),N=i.height()+s.clientY<l(window).height()?C:C-i.height(),i.css("top",N).css("left",A).css("position","fixed").show(),l(this).parents().on("click",function(){i.hide()}),l("#iframe-content").find("iframe").contents().find("body").on("click",function(){i.hide()})}),f(e.nav,"dblclick",".mt-nav-tab",function(){if(n.dbclickRefresh===!0){var s=l(this),i=s.closest("li"),r=a._getNavTab(i),c=a._getTabPane(r),o=r.length?a._getParam(r):{},v=l(c);v.is("iframe")?v.attr("src",o.url):l.ajax({url:o.url,dataType:"html",success:function(u){v.html(a.options.content.ajax.success(u))},error:function(u){v.html(a.options.content.ajax.error(u))}})}return!1}),f(e.nav,"click",".mt-close-tab",function(){return a.close(l(this).closest("li")),!1}),f(e.nav,"click",".mt-move-left",function(){return a.moveLeft(),!1}),f(e.nav,"click",".mt-move-right",function(){return a.moveRight(),!1}),f(e.nav,"click",".mt-show-actived-tab",function(){a.showActive()}),f(e.nav,"click",".mt-close-all-tabs",function(){a.closeAll()}),f(e.nav,"click",".mt-close-other-tabs",function(){a.closeOthers()}),t=e.nav.outerHeight(),e.tabContent.css("paddingTop",t),n.nav.fixed&&f(l(window),"scroll",function(){var s=l(this).scrollTop();return s=s<e.wrapper.height()-t?s+"px":"auto",e.nav.css("top",s),!1}),n.nav.layout==="classic"&&f(e.nav,"click",".mt-dropdown:not(.open)",function(){var s=a._getHiddenList(),i=e.navToolsRight.find(".mt-hidden-list:first").empty();if(s){for(;s.prevList.length;)i.append(s.prevList.shift().clone());for(;s.nextList.length;)i.append(s.nextList.shift().clone())}else i.append("<li>empty</li>")}),a},_getParam:function(t){if(l.isEmptyObject(t))return!1;var a=this,e=a.options,n={},s=l(t),i=s.data();return n.content=i.content||t.content||"",n.content.length?n.url="":(n.url=i.url||t.url||s.attr("href")||s.attr("url")||"",n.url=l.trim(decodeURIComponent(n.url.replace("#","")))),n.url.length||n.content.length?(n.isNewTab=i.hasOwnProperty("isNewTab")||t.hasOwnProperty("isNewTab")||e.isNewTab,n.iframe=i.iframe||t.iframe||S(n.url)||e.iframe,n.type=i.type||t.type||e.type,n.title=i.title||t.title||s.text()||n.url.replace("http://","").replace("https://","")||e.language.nav.title,n.title=O(n.title,e.nav.maxTitleLength),n.active=i.active||t.active||!1,n.index=i.index||t.index||W(n.type,e.nav.maxTabs),n.did=i.did||t.did||this._generateId(n),n):!1},_storage:function(t,a){if(T(this.options.cache)){var e=JSON.parse(sessionStorage.multitabs||"{}");return t?a?(e[t]=a,sessionStorage.multitabs=JSON.stringify(e),e):e[t]:e}return{}},_delStorage:function(t){if(T(this.options.cache)){var a=JSON.parse(sessionStorage.multitabs||"{}");return t&&(delete a[t],sessionStorage.multitabs=JSON.stringify(a)),a}return{}},_resetStorage:function(t){T(this.options.cache)&&typeof t=="object"&&(sessionStorage.multitabs=JSON.stringify(t))},_exist:function(t){var a,e,n;return t&&t.url?(a=this,e=a.$element,n=e.navPanelList.find('a[data-url="'+t.url+'"]:first'),n.length?n:!1):!1},_getTabPane:function(t){return l("#"+l(t).attr("data-id"))},_getNavTab:function(t){var a=this,e=a.$element,n=l(t).attr("data-id")||l(t).find("a").attr("data-id");return e.navPanelList.find('a[data-id="'+n+'"]:first')},_fixTabPosition:function(t){var a=this,e=a.$element,n=l(t).parent("li"),s=n.outerWidth(!0),i=n.prev().outerWidth(!0),r=n.prev().prev().outerWidth(!0),c=h(n.prevAll()),o=h(n.nextAll()),v=e.navPanel.outerWidth(!0),u=h(e.navPanelList.children("li")),d=0;if(v>u)d=0;else if(v>=i+s+o)for(d=c;v>u-d+i;)n=n.prev(),d-=n.outerWidth();else c+s>v&&(d=c-i-r);d=d>0?d:0,e.navPanelList.animate({marginLeft:0-d+"px"},"fast")},_getHiddenList:function(){var t,a,e=this,n=e.$element,s=Math.abs(parseInt(n.navPanelList.css("margin-left"))),i=n.navPanel.outerWidth(!0),r=h(n.navPanelList.children("li")),c=[],o=[];if(i>r)return!1;for(t=n.navPanelList.children("li:first"),a=0;a+t.width()<=s;)a+=t.outerWidth(!0),c.push(t),t=t.next();if(r>a)for(t=n.navPanelList.children("li:last"),a=r;a>s+i;)a-=t.outerWidth(!0),o.unshift(t),t=t.prev();return{prevList:c,nextList:o}},_fixTabContentLayout:function(t){var a=l(t);a.is("iframe")?(l("body").addClass("full-height-layout"),a.css("height","99%"),window.setTimeout(function(){a.css("height","100%")},0)):l("body").removeClass("full-height-layout")}},l.fn.multitabs=function(t,a){var e,n=l(this),s=a||"multitabs",i=l(document).data(s),r=typeof t=="object"&&t;return i||(e=l.extend(!0,{},l.fn.multitabs.defaults,r,n.data()),e.nav.style=e.nav.style==="nav-pills"?"nav-pills":"nav-tabs",i=new L(this,e),l(document).data(s,i)),l(document).data(s)},l.fn.multitabs.defaults={selector:".multitabs",iframe:!1,cache:!1,class:"",type:"info",init:[],isNewTab:!1,refresh:"no",dbclickRefresh:!1,nav:{backgroundColor:"#f5f5f5",class:"",draggable:!0,fixed:!1,layout:"default",maxTabs:15,maxTitleLength:25,showCloseOnHover:!1,style:"nav-tabs"},content:{ajax:{class:"",error:function(t){return t},success:function(t){return t}},iframe:{class:""}},language:{nav:{title:"Tab",dropdown:'<i class="mdi mdi-menu"></i>',showActivedTab:"\u663E\u793A\u5F53\u524D\u9009\u9879\u5361",closeAllTabs:"\u5173\u95ED\u6240\u6709\u6807\u7B7E\u9875",closeOtherTabs:"\u5173\u95ED\u5176\u4ED6\u6807\u7B7E\u9875"}}}})(jQuery);
