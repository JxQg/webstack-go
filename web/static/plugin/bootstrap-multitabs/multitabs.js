if(typeof jQuery>"u")throw new Error("MultiTabs requires jQuery");(function(l){"use strict";var _,p,P,u,k,H,h,A,T,b,N;_=".multitabs",u=function(t,e,a,n,i){var s=i?e:e.split(" ").join(_+" ")+_;t.off(s,a,n).on(s,a,n)},k=function(t,e){return t==="main"?0:(e=e||8,p=p||0,p++,p=p%e,p)},A=function(t,e){e=e||l.fn.multitabs.defaults.navTab.maxTitleLength;for(var a=(t+"").split(" "),n="",i=0;i<a.length;i++){var s=l.trim(a[i]);n+=s?s+" ":""}return n.length>e&&(n=n.substr(0,e),n+="..."),n},T=function(t){return sessionStorage!==void 0&&t},h=function(t){var e=0;return l(t).each(function(){e+=l(this).outerWidth(!0)}),e},H=function(t){var e=function(i){var s=document.createElement("a");return s.href=i,s.href}(t),a=window.location.protocol+"//"+window.location.host+"/",n=e.substr(0,a.length);return n!==a},b={default:'<div class="mt-wrapper {mainClass}" style="height: 100%;" ><div class="mt-nav-bar {navClass}" style="background-color: {backgroundColor};"><div class="mt-nav mt-nav-tools-left"><ul  class="nav {nav-tabs}"><li class="nav-item mt-move-left"><a class="nav-link"><i class="mdi mdi-skip-backward"></i></a></li></ul></div><nav class="mt-nav mt-nav-panel"><ul  class="nav {nav-tabs}"></ul></nav><div class="mt-nav mt-nav-tools-right"><ul  class="nav {nav-tabs}"><li class="nav-item mt-move-right"><a class="nav-link"><i class="mdi mdi-skip-forward"></i></a></li><li class="nav-item mt-dropdown dropdown"><a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">{dropdown}<span class="caret"></span></a><ul role="menu" class="dropdown-menu dropdown-menu-right"><li class="mt-show-actived-tab"><a class="dropdown-item">{showActivedTab}</a></li><li class="dropdown-divider"></li><li class="mt-close-all-tabs"><a class="dropdown-item">{closeAllTabs}</a></li><li class="mt-close-other-tabs"><a class="dropdown-item">{closeOtherTabs}</a></li></ul></li></ul></div></div><div class="tab-content mt-tab-content " > </div></div>',classic:'<div class="mt-wrapper {mainClass}" style="height: 100%;" ><div class="mt-nav-bar {navClass}" style="background-color: {backgroundColor};"><nav class="mt-nav mt-nav-panel"><ul  class="nav {nav-tabs}"> </ul></nav><div class="mt-nav mt-nav-tools-right"><ul  class="nav {nav-tabs}"><li class="mt-dropdown dropdown"><a href="#"  class="dropdown-toggle dropdown-item" data-toggle="dropdown">{dropdown}<span class="caret"></span></a><ul role="menu" class="mt-hidden-list dropdown-menu dropdown-menu-right"></ul></li></ul></div></div><div class="tab-content mt-tab-content " > </div></div>',simple:'<div class="mt-wrapper {mainClass}" style="height: 100%;" ><div class="mt-nav-bar {navClass}" style="background-color: {backgroundColor};"><nav class="mt-nav mt-nav-panel"><ul  class="nav {nav-tabs}"> </ul></nav></div><div class="tab-content mt-tab-content " > </div></div>',navTab:'<a data-id="{navTabId}" class="nav-link mt-nav-tab" data-type="{type}" data-index="{index}" data-url="{url}">{title}</a>',closeBtn:' <i class="mt-close-tab mdi mdi-close" style="{style}"></i>',ajaxTabPane:'<div id="{tabPaneId}" class="tab-pane {class}">{content}</div>',iframeTabPane:'<iframe id="{tabPaneId}" class="tab-pane {class}"  width="100%" height="100%" frameborder="0" src="" seamless></iframe>'},N=[{type:"main",title:"main",content:"<h1>Demo page</h1><h2>Welcome to use bootstrap multi-tabs :) </h2>"}],P=function(t,e){var a=this;a.$element=l(t),a._init(e)._listen()._final()},P.prototype={constructor:P,create:function(t,e){var a=this.options,n,i;return(n=this._getParam(t))?(i=this._exist(n),i&&!n.isNewTab?(this.active(i),this):(n.active=n.active?n.active:e,i=this._createNavTab(n),this._createTabPane(n),this._storage(n.did,n),n.active&&this.active(i),this)):this},_createTabPane:function(t){var e=this,a=e.$element;return a.tabContent.append(e._getTabPaneHtml(t)),a.tabContent.find("#"+t.did)},_getTabPaneHtml:function(t){var e=this,a=e.options;return!t.content&&t.iframe?b.iframeTabPane.replace("{class}",a.content.iframe.class).replace("{tabPaneId}",t.did):b.ajaxTabPane.replace("{class}",a.content.ajax.class).replace("{tabPaneId}",t.did).replace("{content}",t.content)},_createNavTab:function(t){var e=this,a=e.$element,n=e._getNavTabHtml(t),i=a.navPanelList.find('a[data-type="'+t.type+'"][data-index="'+t.index+'"]').parent("li");return i.length?(i.html(n),e._getTabPane(i.find("a:first")).remove()):a.navPanelList.append('<li class="nav-item">'+n+"</li>"),a.navPanelList.find('a[data-type="'+t.type+'"][data-index="'+t.index+'"]:first')},_getNavTabHtml:function(t){var e=this,a=e.options,n,i;return i=a.nav.showCloseOnHover?"":"display:inline;",n=t.type==="main"?"":b.closeBtn.replace("{style}",i),b.navTab.replace("{index}",t.index).replace("{navTabId}",t.did).replace("{url}",t.url).replace("{title}",t.title).replace("{type}",t.type)+n},_generateId:function(t){return"multitabs_"+t.type+"_"+t.index},active:function(t,e){var a=this,n=a.$element;e=e!=!1;var i=a._getNavTab(t),s=a._getTabPane(i),r=n.navPanelList.find("li a.active"),o=r.length?a._getParam(r):{},c=i.length?a._getParam(i):{},v=a._storage();return v[o.id]&&(v[o.id].active=!1),v[c.id]&&(v[c.id].active=!0),a._resetStorage(v),r.removeClass("active"),i.addClass("active"),a._fixTabPosition(i),a._getTabPane(r).removeClass("active"),s.addClass("active"),a._fixTabContentLayout(s),a._fillTabPane(s,c,e),a},_fillTabPane:function(t,e,a){var n=this,i=n.options,s=l(t);s.html()||(s.is("iframe")?(!s.attr("src")&&i.refresh=="no"||i.refresh=="nav"&&a||i.refresh=="all")&&s.attr("src",e.url):l.ajax({url:e.url,dataType:"html",success:function(r){s.html(i.content.ajax.success(r))},error:function(r){s.html(i.content.ajax.error(r))}}))},moveLeft:function(){var t=this,e=t.$element,a=Math.abs(parseInt(e.navPanelList.css("margin-left"))),n=e.navPanel.outerWidth(!0),i=h(e.navPanelList.children("li")),s=0,r=0,o;if(i<n)return t;for(o=e.navPanelList.children("li:first");r+o.width()<=a;)r+=o.outerWidth(!0),o=o.next();if(r=0,h(o.prevAll())>n){for(;r+o.width()<n&&o.length>0;)r+=o.outerWidth(!0),o=o.prev();s=h(o.prevAll())}return e.navPanelList.animate({marginLeft:0-s+"px"},"fast"),t},moveRight:function(){var t=this,e=t.$element,a=Math.abs(parseInt(e.navPanelList.css("margin-left"))),n=e.navPanel.outerWidth(!0),i=h(e.navPanelList.children("li")),s=0,r,o;if(i<n)return t;for(r=e.navPanelList.children("li:first"),o=0;o+r.width()<=a;)o+=r.outerWidth(!0),r=r.next();for(o=0;o+r.width()<n&&r.length>0;)o+=r.outerWidth(!0),r=r.next();return s=h(r.prevAll()),s>0&&e.navPanelList.animate({marginLeft:0-s+"px"},"fast"),t},close:function(t){var e=this,a,n=e._getNavTab(t),i=n.parent("li");if(a=e._getTabPane(n),i.length&&a.length&&a.hasClass("unsave")&&!e._unsaveConfirm())return e;if(i.find("a").hasClass("active")){var s=i.next("li:first"),r=i.prev("li:last");s.length?(e.active(s),e.activeMenu(s.find("a"))):r.length&&(e.active(r),e.activeMenu(r.find("a")))}return e._delStorage(n.attr("data-id")),i.remove(),a.remove(),e},closeOthers:function(t){var e=this,a=e.$element,n;return t?n=a.navPanelList.find('a:not([data-type="main"])').filter(function(i){if(t!=l(this).data("index"))return this}):n=a.navPanelList.find('li a:not([data-type="main"],.active)'),n.each(function(){var i=l(this);e._delStorage(i.attr("data-id")),e._getTabPane(i).remove(),i.parent("li").remove()}),t&&(e.active(a.navPanelList.find('a[data-index="'+t+'"]')),e.activeMenu(a.navPanelList.find('a[data-index="'+t+'"]'))),a.navPanelList.css("margin-left","0"),e},showActive:function(){var t=this,e=t.$element,a=e.navPanelList.find("li a.active");return t._fixTabPosition(a),t},closeAll:function(){var t=this,e=t.$element;return e.navPanelList.find('a:not([data-type="main"])').each(function(){var a=l(this);t._delStorage(a.attr("data-id")),t._getTabPane(a).remove(),a.parent("li").remove()}),t.active(e.navPanelList.find('a[data-type="main"]:first').parent("li")),t.activeMenu(e.navPanelList.find('a[data-type="main"]:first')),t},activeMenu:function(t){var e=l("a[href$='"+l(t).data("url")+"']"),a=e.parents(".nav-item"),n=a.siblings().find(".nav-subnav:visible").outerHeight();if(l(".nav-item").each(function(s){l(this).hasClass("active")&&!e.parents(".nav-item").last().hasClass("active")&&(l(this).removeClass("active").removeClass("open"),l(this).find(".nav-subnav:visible").slideUp(500),window.innerWidth>1024&&l("body").hasClass("lyear-layout-sidebar-close")&&l(this).find(".nav-subnav").hide())}),l(".nav-drawer").find("li").removeClass("active"),e.parent("li").addClass("active"),a.first().addClass("active"),!e.parents(".nav-item").first().is(".nav-item-has-subnav")){var i=48*(e.parents(".nav-item").first().prevAll().length-1);l(".lyear-layout-sidebar-info").animate({scrollTop:i},300)}e.parents("ul.nav-subnav").last().is(":hidden")&&e.parents("ul.nav-subnav").last().slideDown(500,function(){a.last().addClass("open");var s=0,r=l(".lyear-layout-sidebar-info"),o=a.last().prevAll().length,c=r.outerHeight(),v=l(".sidebar-main").outerHeight(),f=r.scrollTop(),d=l(this).outerHeight(),g=121;g+v-c>=o*48&&(s=o*48),a.length==1?r.animate({scrollTop:s},300):typeof n<"u"&&n!=null?(s=f+d-n,r.animate({scrollTop:s},300)):f+c-r[0].scrollHeight==0&&(s=f-d,r.animate({scrollTop:s},300))})},_init:function(t){var e=this,a=e.$element;return a.html(b[t.nav.layout].replace("{mainClass}",t.class).replace("{navClass}",t.nav.class).replace(/\{nav-tabs\}/g,t.nav.style).replace(/\{backgroundColor\}/g,t.nav.backgroundColor).replace("{dropdown}",t.language.nav.dropdown).replace("{showActivedTab}",t.language.nav.showActivedTab).replace("{closeAllTabs}",t.language.nav.closeAllTabs).replace("{closeOtherTabs}",t.language.nav.closeOtherTabs)),a.wrapper=a.find(".mt-wrapper:first"),a.nav=a.find(".mt-nav-bar:first"),a.navToolsLeft=a.nav.find(".mt-nav-tools-left:first"),a.navPanel=a.nav.find(".mt-nav-panel:first"),a.navPanelList=a.nav.find(".mt-nav-panel:first ul"),a.navToolsRight=a.nav.find(".mt-nav-tools-right:first"),a.tabContent=a.find(".tab-content:first"),t.nav.maxTabs<=1&&(t.nav.maxTabs=1,a.nav.hide()),a.navPanel.css("width","calc(100% - 147px)"),e.options=t,e},_final:function(){var t=this,e=t.$element,a=t.options,n,i=a.init,s;if(T(a.cache)&&(n=t._storage(),t._resetStorage({}),l.each(n,function(o,c){t.create(c,!1)})),l.isEmptyObject(n)){i=!l.isEmptyObject(i)&&i instanceof Array?i:N;for(var r=0;r<i.length;r++)s=t._getParam(i[r]),s&&t.create(s)}return e.navPanelList.children("li a.active").length||t.active(e.navPanelList.find('[data-type="main"]:first')),t},_listen:function(){var t=this,e=t.$element,a=t.options;u(l(document),"click",a.selector,function(){if(t.create(this,!0),!l(this).parent().parent("ul").hasClass("dropdown-menu"))return!1}),u(e.nav,"click",".mt-nav-tab",function(){t.active(this,!1),t.activeMenu(this)}),a.nav.draggable&&u(e.navPanelList,"mousedown",".mt-nav-tab",function(i){var s=l(this),r=s.closest("li"),o=r.prev(),c=!0,v=!1,f=s.data("type")==="main",d="mt_tmp_id_"+new Date().getTime(),g='<li id="'+d+'" class="mt-dragging" style="width:'+r.outerWidth()+"px; height:"+r.outerHeight()+'px;"><a style="width: 100%;  height: 100%; "></a></li>',m=i.pageX-r.offset().left+e.nav.offset().left;r.before(g),r.addClass("mt-dragging mt-dragging-tab").css({left:i.pageX-m+"px"}),l(document).on("mousemove",function(y){c&&!f&&(r.css({left:y.pageX-m+"px"}),e.navPanelList.children('li:not(".mt-dragging")').each(function(){var w=l(this).offset().left+l(this).outerWidth()+20;if(w>r.offset().left)return l(this).next().attr("id")!==d&&(v=!0,o=l(this),l("#"+d).remove(),o.after(g)),!1}))}).on("selectstart",function(){if(c)return!1}).on("mouseup",function(){c&&(r.removeClass("mt-dragging mt-dragging-tab").css({left:"auto"}),v&&o.after(r),l("#"+d).remove()),c=!1})}),u(e.nav,"contextmenu",".mt-nav-tab",function(i){i.preventDefault();var s=l('<ul class="dropdown-menu" role="menu" id="contextify-menu"/>'),r=l(this),o=r.closest("li"),c=t._getNavTab(o),v=t._getTabPane(c),d=c.length?t._getParam(c):{},f=[{text:"\u5237\u65B0",onclick:function(){var x=l(v);return x.is("iframe")?x.attr("src",d.url):l.ajax({url:d.url,dataType:"html",success:function(W){x.html(t.options.content.ajax.success(W))},error:function(W){x.html(t.options.content.ajax.error(W))}}),s.hide(),!1}}],d=t._getParam(c);d.type!=="main"&&f.push({text:"\u5173\u95ED",onclick:function(){return t.close(c),s.hide(),!1}}),f.push({text:"\u5173\u95ED\u5176\u4ED6",onclick:function(){return t.closeOthers(c.data("index")),s.hide(),!1}});var g=f.length,m;for(m=0;m<g;m++){var y=f[m],w=l("<li/>");w.append('<a class="dropdown-item" />');var L=w.find("a");L.on("click",y.onclick),L.css("cursor","pointer"),L.html(y.text),s.append(w)}var C=l("#contextify-menu");C.length>0?C!==s&&C.replaceWith(s):l("body").append(s);var S=l(window).scrollTop()+i.clientY,O=s.width()+i.clientX<l(window).width()?i.clientX:i.clientX-s.width(),M=s.height()+i.clientY<l(window).height()?S:S-s.height();s.css("top",M).css("left",O).css("position","fixed").show(),l(this).parents().on("click",function(){s.hide()}),l("#iframe-content").find("iframe").contents().find("body").on("click",function(){s.hide()})}),u(e.nav,"dblclick",".mt-nav-tab",function(i){if(a.dbclickRefresh===!0){var s=l(this),r=s.closest("li"),o=t._getNavTab(r),c=t._getTabPane(o),v=o.length?t._getParam(o):{},f=l(c);f.is("iframe")?f.attr("src",v.url):l.ajax({url:v.url,dataType:"html",success:function(d){f.html(t.options.content.ajax.success(d))},error:function(d){f.html(t.options.content.ajax.error(d))}})}return!1}),u(e.nav,"click",".mt-close-tab",function(){return t.close(l(this).closest("li")),!1}),u(e.nav,"click",".mt-move-left",function(){return t.moveLeft(),!1}),u(e.nav,"click",".mt-move-right",function(){return t.moveRight(),!1}),u(e.nav,"click",".mt-show-actived-tab",function(){t.showActive()}),u(e.nav,"click",".mt-close-all-tabs",function(){t.closeAll()}),u(e.nav,"click",".mt-close-other-tabs",function(){t.closeOthers()});var n=e.nav.outerHeight();return e.tabContent.css("paddingTop",n),a.nav.fixed&&u(l(window),"scroll",function(){var i=l(this).scrollTop();return i=i<e.wrapper.height()-n?i+"px":"auto",e.nav.css("top",i),!1}),a.nav.layout==="classic"&&u(e.nav,"click",".mt-dropdown:not(.open)",function(){var i=t._getHiddenList(),s=e.navToolsRight.find(".mt-hidden-list:first").empty();if(i){for(;i.prevList.length;)s.append(i.prevList.shift().clone());for(;i.nextList.length;)s.append(i.nextList.shift().clone())}else s.append("<li>empty</li>")}),t},_getParam:function(t){if(l.isEmptyObject(t))return!1;var e=this,a=e.options,n={},i=l(t),s=i.data();return n.content=s.content||t.content||"",n.content.length?n.url="":(n.url=s.url||t.url||i.attr("href")||i.attr("url")||"",n.url=l.trim(decodeURIComponent(n.url.replace("#","")))),!n.url.length&&!n.content.length?!1:(n.isNewTab=s.hasOwnProperty("isNewTab")||t.hasOwnProperty("isNewTab")||a.isNewTab,n.iframe=s.iframe||t.iframe||H(n.url)||a.iframe,n.type=s.type||t.type||a.type,n.title=s.title||t.title||i.text()||n.url.replace("http://","").replace("https://","")||a.language.nav.title,n.title=A(n.title,a.nav.maxTitleLength),n.active=s.active||t.active||!1,n.index=s.index||t.index||k(n.type,a.nav.maxTabs),n.did=s.did||t.did||this._generateId(n),n)},_storage:function(t,e){if(T(this.options.cache)){var a=JSON.parse(sessionStorage.multitabs||"{}");return t?e?(a[t]=e,sessionStorage.multitabs=JSON.stringify(a),a):a[t]:a}return{}},_delStorage:function(t){if(T(this.options.cache)){var e=JSON.parse(sessionStorage.multitabs||"{}");return t&&(delete e[t],sessionStorage.multitabs=JSON.stringify(e)),e}return{}},_resetStorage:function(t){T(this.options.cache)&&typeof t=="object"&&(sessionStorage.multitabs=JSON.stringify(t))},_exist:function(t){if(!t||!t.url)return!1;var e=this,a=e.$element,n=a.navPanelList.find('a[data-url="'+t.url+'"]:first');return n.length?n:!1},_getTabPane:function(t){return l("#"+l(t).attr("data-id"))},_getNavTab:function(t){var e=this,a=e.$element,n=l(t).attr("data-id")||l(t).find("a").attr("data-id");return a.navPanelList.find('a[data-id="'+n+'"]:first')},_fixTabPosition:function(t){var e=this,a=e.$element,n=l(t).parent("li"),i=n.outerWidth(!0),s=n.prev().outerWidth(!0),r=n.prev().prev().outerWidth(!0),o=h(n.prevAll()),c=h(n.nextAll()),v=a.navPanel.outerWidth(!0),f=h(a.navPanelList.children("li")),d=0;if(f<v)d=0;else if(s+i+c<=v)for(d=o;f-d+s<v;)n=n.prev(),d-=n.outerWidth();else o+i>v&&(d=o-s-r);d=d>0?d:0,a.navPanelList.animate({marginLeft:0-d+"px"},"fast")},_getHiddenList:function(){var t=this,e=t.$element,a=Math.abs(parseInt(e.navPanelList.css("margin-left"))),n=e.navPanel.outerWidth(!0),i=h(e.navPanelList.children("li")),s=[],r=[],o,c;if(i<n)return!1;for(o=e.navPanelList.children("li:first"),c=0;c+o.width()<=a;)c+=o.outerWidth(!0),s.push(o),o=o.next();if(i>c)for(o=e.navPanelList.children("li:last"),c=i;c>a+n;)c-=o.outerWidth(!0),r.unshift(o),o=o.prev();return{prevList:s,nextList:r}},_fixTabContentLayout:function(t){var e=l(t);e.is("iframe")?(l("body").addClass("full-height-layout"),e.css("height","99%"),window.setTimeout(function(){e.css("height","100%")},0)):l("body").removeClass("full-height-layout")}},l.fn.multitabs=function(t,e){var a=l(this),n=e||"multitabs",i=l(document).data(n),s=typeof t=="object"&&t,r;return i||(r=l.extend(!0,{},l.fn.multitabs.defaults,s,a.data()),r.nav.style=r.nav.style==="nav-pills"?"nav-pills":"nav-tabs",i=new P(this,r),l(document).data(n,i)),l(document).data(n)},l.fn.multitabs.defaults={selector:".multitabs",iframe:!1,cache:!1,class:"",type:"info",init:[],isNewTab:!1,refresh:"no",dbclickRefresh:!1,nav:{backgroundColor:"#f5f5f5",class:"",draggable:!0,fixed:!1,layout:"default",maxTabs:15,maxTitleLength:25,showCloseOnHover:!1,style:"nav-tabs"},content:{ajax:{class:"",error:function(t){return t},success:function(t){return t}},iframe:{class:""}},language:{nav:{title:"Tab",dropdown:'<i class="mdi mdi-menu"></i>',showActivedTab:"\u663E\u793A\u5F53\u524D\u9009\u9879\u5361",closeAllTabs:"\u5173\u95ED\u6240\u6709\u6807\u7B7E\u9875",closeOtherTabs:"\u5173\u95ED\u5176\u4ED6\u6807\u7B7E\u9875"}}}})(jQuery);
