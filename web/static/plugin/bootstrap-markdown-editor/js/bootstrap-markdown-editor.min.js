(function(l){"use strict";function S(i,e,f,d,t){if(e.length){t.show();var o=new FormData,p=0;for(p=0;p<e.length;p++)o.append("file"+p,e[p]);l.ajax({url:i,type:"POST",contentType:!1,data:o,processData:!1,cache:!1,dataType:"json"}).done(function(u){var c="";1<u.length&&(c=`
`);for(var r=0;r<u.length;r++)d.insertSnippet(f,"![]("+u[r]+")"+c)}).always(function(){t.hide()})}}function y(i){var e,f=l(window).height(),d=i.offset().top;d<f&&(e=f-d,i.css("height",e+"px"))}function v(i,e){i.getCursorPosition().column===0?(i.navigateLineStart(),i.insert(e+" ")):(i.navigateLineStart(),i.insert(e+" "),i.navigateLineEnd())}var w={init:function(i){var e,f,d,t,o=l.extend(!0,{},l.fn.markdownEditor.defaults,i),p=this,u=!1,c=!1;p.addClass("md-textarea-hidden"),e=l("<div/>"),p.after(e),e.addClass("md-container").html((f=p.val(),t="",t+='<div class="md-loading"><span class="md-icon-container"><span class="md-icon"></span></span></div>',t+='<div class="md-toolbar">',t+='<div class="btn-toolbar">',t+='<div class="btn-group">',t+='<button type="button" data-mdtooltip="tooltip" title="'+(d=o).label.btnHeader1+'" class="md-btn btn btn-default" data-btn="h1"><span class="mdi mdi-format-header-1"></span></button>',t+='<button type="button" data-mdtooltip="tooltip" title="'+d.label.btnHeader2+'" class="md-btn btn btn-default" data-btn="h2"><span class="mdi mdi-format-header-2"></span></button>',t+='<button type="button" data-mdtooltip="tooltip" title="'+d.label.btnHeader3+'" class="md-btn btn btn-default" data-btn="h3"><span class="mdi mdi-format-header-3"></span></button>',t+="</div>",t+='<div class="btn-group">',t+='<button type="button" data-mdtooltip="tooltip" title="'+d.label.btnBold+'" class="md-btn btn btn-default" data-btn="bold"><span class="mdi mdi-format-bold"></span></button>',t+='<button type="button" data-mdtooltip="tooltip" title="'+d.label.btnItalic+'" class="md-btn btn btn-default" data-btn="italic"><span class="mdi mdi-format-italic"></span></button>',t+="</div>",t+='<div class="btn-group">',t+='<button type="button" data-mdtooltip="tooltip" title="'+d.label.btnList+'" class="md-btn btn btn-default" data-btn="ul"><span class="mdi mdi-format-list-bulleted"></span></button>',t+='<button type="button" data-mdtooltip="tooltip" title="'+d.label.btnOrderedList+'" class="md-btn btn btn-default" data-btn="ol"><span class="mdi mdi-format-list-numbered"></span></button>',t+="</div>",t+='<div class="btn-group">',t+='<button type="button" data-mdtooltip="tooltip" title="'+d.label.btnLink+'" class="md-btn btn btn-default" data-btn="link"><span class="mdi mdi-link"></span></button>',t+='<button type="button" data-mdtooltip="tooltip" title="'+d.label.btnImage+'" class="md-btn btn btn-default" data-btn="image"><span class="mdi mdi-image"></span></button>',d.imageUpload===!0&&(t+='<div data-mdtooltip="tooltip" title="'+d.label.btnUpload+'" class="btn btn-default md-btn-file"><span class="fas fa-upload"></span><input class="md-input-upload" type="file" multiple accept=".jpg,.jpeg,.png,.gif"></div>'),t+="</div>",d.fullscreen===!0&&(t+='<div class="btn-group pull-right">',t+='<button type="button" class="md-btn btn btn-default btn-xs" data-btn="fullscreen"><span class="mdi mdi-fullscreen"></span> '+d.label.btnFullscreen+"</button>",t+="</div>"),d.preview===!0&&(t+='<div class="btn-group pull-right">',t+='<button type="button" class="md-btn btn btn-default btn-xs btn-edit active" data-btn="edit"><span class="mdi mdi-pencil"></span> '+d.label.btnEdit+"</button>",t+='<button type="button" class="md-btn btn btn-default btn-xs" data-btn="preview"><span class="mdi mdi-eye"></span> '+d.label.btnPreview+"</button>",t+="</div>"),t+="</div>",t+="</div>",t+='<div class="md-editor">'+l("<div>").text(f).html()+"</div>",t+='<div class="md-preview" style="display:none"></div>')),typeof l().tooltip=="function"&&e.find('[data-mdtooltip="tooltip"]').tooltip({container:"body"});var r=e.find(".md-editor"),m=e.find(".md-preview"),x=e.find(".md-loading");e.css({width:o.width}),r.css({height:o.height,fontSize:o.fontSize}),m.css({height:o.height});var h,n=ace.edit(r[0]);return n.setTheme("ace/theme/"+o.theme),n.getSession().setMode("ace/mode/markdown"),n.getSession().setUseWrapMode(!0),n.getSession().setUseSoftTabs(o.softTabs),n.getSession().on("change",function(){p.val(n.getSession().getValue())}),n.setHighlightActiveLine(!1),n.setShowPrintMargin(!1),n.renderer.setShowGutter(!1),ace.config.loadModule("ace/ext/language_tools",function(){var a,b;h=ace.require("ace/snippets").snippetManager,b=h,(a=n).commands.addCommand({name:"bold",bindKey:{win:"Ctrl-B",mac:"Command-B"},exec:function(s){var g=s.session.getTextRange(s.getSelectionRange());g===""?b.insertSnippet(s,"**${1:text}**"):b.insertSnippet(s,"**"+g+"**")},readOnly:!1}),a.commands.addCommand({name:"italic",bindKey:{win:"Ctrl-I",mac:"Command-I"},exec:function(s){var g=s.session.getTextRange(s.getSelectionRange());g===""?b.insertSnippet(s,"*${1:text}*"):b.insertSnippet(s,"*"+g+"*")},readOnly:!1}),a.commands.addCommand({name:"link",bindKey:{win:"Ctrl-K",mac:"Command-K"},exec:function(s){var g=s.session.getTextRange(s.getSelectionRange());g===""?b.insertSnippet(s,"[${1:text}](http://$2)"):b.insertSnippet(s,"["+g+"](http://$1)")},readOnly:!1})}),o.imageUpload&&(e.find(".md-input-upload").on("change",function(){var a=l(this).get(0).files;S(o.uploadPath,a,n,h,x)}),e.on("dragenter",function(a){a.stopPropagation(),a.preventDefault()}),e.on("dragover",function(a){a.stopPropagation(),a.preventDefault()}),e.on("drop",function(a){a.preventDefault();var b=a.originalEvent.dataTransfer.files;S(o.uploadPath,b,n,h,x)})),o.fullscreen===!0&&l(window).resize(function(){c===!0&&y(u===!1?r:m)}),e.find(".md-btn").click(function(){var a=l(this).data("btn"),b=n.session.getTextRange(n.getSelectionRange());a==="h1"?v(n,"#"):a==="h2"?v(n,"##"):a==="h3"?v(n,"###"):a==="ul"?v(n,"*"):a==="ol"?v(n,"1."):a==="bold"?n.execCommand("bold"):a==="italic"?n.execCommand("italic"):a==="link"?n.execCommand("link"):a==="image"?b===""?h.insertSnippet(n,"![${1:text}](http://$2)"):h.insertSnippet(n,"!["+b+"](http://$1)"):a==="edit"?(u=!1,m.hide(),r.show(),e.find(".btn-edit").addClass("active"),e.find(".btn-preview").removeClass("active"),c===!0&&y(r)):a==="preview"?(u=!0,m.html('<p style="text-align:center; font-size:16px">'+o.label.loading+"...</p>"),o.onPreview(n.getSession().getValue(),function(s){m.html(s)}),r.hide(),m.show(),e.find(".btn-preview").addClass("active"),e.find(".btn-edit").removeClass("active"),c===!0&&y(m)):a==="fullscreen"&&(c===!0?(c=!1,l("body, html").removeClass("md-body-fullscreen"),e.removeClass("md-fullscreen"),r.css("height",o.height),m.css("height",o.height)):(c=!0,l("body, html").addClass("md-body-fullscreen"),e.addClass("md-fullscreen"),y(u===!1?r:m)),n.resize()),n.focus()}),this},content:function(){return ace.edit(this.find(".md-editor")[0]).getSession().getValue()},setContent:function(i){ace.edit(this.find(".md-editor")[0]).setValue(i,1)}};l.fn.markdownEditor=function(i){return w[i]?w[i].apply(this,Array.prototype.slice.call(arguments,1)):typeof i!="object"&&i?void l.error("Method "+i+" does not exist on jQuery.markdownEditor"):w.init.apply(this,arguments)},l.fn.markdownEditor.defaults={width:"100%",height:"400px",fontSize:"14px",theme:"tomorrow",softTabs:!0,fullscreen:!0,imageUpload:!1,uploadPath:"",preview:!1,onPreview:function(i,e){e(i)},label:{btnHeader1:"Header 1",btnHeader2:"Header 2",btnHeader3:"Header 3",btnBold:"Bold",btnItalic:"Italic",btnList:"Unordered list",btnOrderedList:"Ordered list",btnLink:"Link",btnImage:"Insert image",btnUpload:"Upload image",btnEdit:"Edit",btnPreview:"Preview",btnFullscreen:"Fullscreen",loading:"Loading"}}})(jQuery);
