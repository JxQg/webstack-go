const Utils=$.fn.bootstrapTable.utils;$.extend($.fn.bootstrapTable.defaults,{usePipeline:!1,pipelineSize:1e3,onCachedDataHit(e){return!1},onCachedDataReset(e){return!1}}),$.extend($.fn.bootstrapTable.Constructor.EVENTS,{"cached-data-hit.bs.table":"onCachedDataHit","cached-data-reset.bs.table":"onCachedDataReset"});const BootstrapTable=$.fn.bootstrapTable.Constructor,_init=BootstrapTable.prototype.init,_initServer=BootstrapTable.prototype.initServer,_onSearch=BootstrapTable.prototype.onSearch,_onSort=BootstrapTable.prototype.onSort,_onPageListChange=BootstrapTable.prototype.onPageListChange;BootstrapTable.prototype.init=function(...e){this.initPipeline(),_init.apply(this,Array.prototype.slice.apply(e))},BootstrapTable.prototype.initPipeline=function(){this.cacheRequestJSON={},this.cacheWindows=[],this.currWindow=0,this.resetCache=!0},BootstrapTable.prototype.onSearch=function(e){this.options.usePipeline&&(this.resetCache=!0),_onSearch.apply(this,Array.prototype.slice.apply(arguments))},BootstrapTable.prototype.onSort=function(e){this.options.usePipeline&&(this.resetCache=!0),_onSort.apply(this,Array.prototype.slice.apply(arguments))},BootstrapTable.prototype.onPageListChange=function(e){const i=$(e.currentTarget),a=parseInt(i.text());this.options.pipelineSize=this.calculatePipelineSize(this.options.pipelineSize,a),this.resetCache=!0,_onPageListChange.apply(this,Array.prototype.slice.apply(arguments))},BootstrapTable.prototype.calculatePipelineSize=(e,i)=>i===0?0:Math.ceil(e/i)*i,BootstrapTable.prototype.setCacheWindows=function(){this.cacheWindows=[];const e=this.options.totalRows/this.options.pipelineSize;for(let i=0;i<=e;i++){const a=i*this.options.pipelineSize;this.cacheWindows[i]={lower:a,upper:a+this.options.pipelineSize-1}}},BootstrapTable.prototype.setCurrWindow=function(e){this.currWindow=0;for(let i=0;i<this.cacheWindows.length;i++)if(this.cacheWindows[i].lower<=e&&e<=this.cacheWindows[i].upper){this.currWindow=i;break}},BootstrapTable.prototype.drawFromCache=function(e,i){const a=$.extend(!0,{},this.cacheRequestJSON),n=e-this.cacheWindows[this.currWindow].lower,p=n+i;return a.rows=a.rows.slice(n,p),a},BootstrapTable.prototype.initServer=function(e,i,a){let n={};const p=this.header.fields.indexOf(this.options.sortName);let t={searchText:this.searchText,sortName:this.options.sortName,sortOrder:this.options.sortOrder},l=null;if(this.header.sortNames[p]&&(t.sortName=this.header.sortNames[p]),this.options.pagination&&this.options.sidePagination==="server"&&(t.pageSize=this.options.pageSize===this.options.formatAllRows()?this.options.totalRows:this.options.pageSize,t.pageNumber=this.options.pageNumber),!(a||this.options.url)&&!this.options.ajax)return;let r=!0;if(this.options.queryParamsType==="limit"&&(t={searchText:t.searchText,sortName:t.sortName,sortOrder:t.sortOrder},this.options.pagination&&this.options.sidePagination==="server"))if(t.limit=this.options.pageSize===this.options.formatAllRows()?this.options.totalRows:this.options.pageSize,t.offset=(this.options.pageSize===this.options.formatAllRows()?this.options.totalRows:this.options.pageSize)*(this.options.pageNumber-1),this.options.usePipeline)if(!this.cacheWindows.length)r=!0,t.drawOffset=t.offset;else{const s=this.cacheWindows[this.currWindow];this.resetCache||t.offset<s.lower||t.offset>s.upper?(r=!0,this.setCurrWindow(t.offset),t.drawOffset=t.offset,t.offset=this.cacheWindows[this.currWindow].lower):r=!1}else t.limit===0&&delete t.limit;if(this.resetCache&&(r=!0,this.resetCache=!1),this.options.usePipeline&&r&&(t.drawLimit=t.limit,t.limit=this.options.pipelineSize),!r){const s=this.drawFromCache(t.offset,t.limit);this.load(s),this.trigger("load-success",s),this.trigger("cached-data-hit",s);return}if($.isEmptyObject(this.filterColumnsPartial)||(t.filter=JSON.stringify(this.filterColumnsPartial,null)),n=Utils.calculateObjectValue(this.options,this.options.queryParams,[t],n),$.extend(n,i||{}),n===!1)return;e||this.$tableLoading.show();const o=this;l=$.extend({},Utils.calculateObjectValue(null,this.options.ajaxOptions),{type:this.options.method,url:a||this.options.url,data:this.options.contentType==="application/json"&&this.options.method==="post"?JSON.stringify(n):n,cache:this.options.cache,contentType:this.options.contentType,dataType:this.options.dataType,success(s){s=Utils.calculateObjectValue(o.options,o.options.responseHandler,[s],s),o.options.usePipeline&&(o.cacheRequestJSON=$.extend(!0,{},s),o.options.totalRows=s[o.options.totalField],o.setCacheWindows(),o.setCurrWindow(t.drawOffset),s=o.drawFromCache(t.drawOffset,t.drawLimit),o.trigger("cached-data-reset",s)),o.load(s),o.trigger("load-success",s),e||o.$tableLoading.hide()},error(s){let h=[];o.options.sidePagination==="server"&&(h={},h[o.options.totalField]=0,h[o.options.dataField]=[]),o.load(h),o.trigger("load-error",s.status,s),e||o.$tableLoading.hide()}}),this.options.ajax?Utils.calculateObjectValue(this,this.options.ajax,[l],null):(this._xhr&&this._xhr.readyState!==4&&this._xhr.abort(),this._xhr=$.ajax(l))};
